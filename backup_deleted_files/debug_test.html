<!DOCTYPE html>
<html>
<head>
    <title>Job Matching Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        button { padding: 10px 20px; font-size: 16px; }
    </style>
</head>
<body>
    <h1>ğŸ” Job Matching Debug Test</h1>
    
    <div class="debug">
        <h3>Test Parameters:</h3>
        <p><strong>Profile ID:</strong> john_developer</p>
        <p><strong>API Endpoint:</strong> /api/match</p>
        <p><strong>Include Database Jobs:</strong> true</p>
        <p><strong>Use AI:</strong> false</p>
    </div>
    
    <button onclick="testJobMatching()">ğŸš€ Test Job Matching API</button>
    
    <div id="results" class="debug" style="display: none;">
        <h3>Results:</h3>
        <div id="output"></div>
    </div>
    
    <script>
        async function testJobMatching() {
            const resultsDiv = document.getElementById('results');
            const outputDiv = document.getElementById('output');
            
            resultsDiv.style.display = 'block';
            outputDiv.innerHTML = '<p>ğŸ”„ Testing API...</p>';
            
            try {
                console.log('ğŸ” Starting job matching test...');
                
                const payload = {
                    profile_id: 'john_developer',
                    include_database_jobs: true,
                    use_ai: false
                };
                
                console.log('ğŸ“¡ Making API call with payload:', payload);
                
                const response = await fetch('/api/match', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });
                
                console.log('ğŸ“¬ Response received:', response.status, response.ok);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const data = await response.json();
                console.log('âœ… Response data:', data);
                
                // Display results
                let html = `<div class="success">âœ… API Call Successful!</div>`;
                html += `<p><strong>Status:</strong> ${data.status}</p>`;
                html += `<p><strong>Profile Name:</strong> ${data.profile_name}</p>`;
                html += `<p><strong>Total Matches:</strong> ${data.total_matches || 0}</p>`;
                html += `<p><strong>Database Matches:</strong> ${data.database_matches || 0}</p>`;
                
                if (data.matches && data.matches.length > 0) {
                    html += `<h4>ğŸ¯ Top 3 Matches:</h4><ul>`;
                    data.matches.slice(0, 3).forEach((match, i) => {
                        html += `<li><strong>${match.title}</strong> - ${match.match_percentage}% match (${match.source})</li>`;
                    });
                    html += `</ul>`;
                } else {
                    html += `<p class="error">âŒ No matches found</p>`;
                }
                
                outputDiv.innerHTML = html;
                
            } catch (error) {
                console.error('âŒ Test failed:', error);
                outputDiv.innerHTML = `<div class="error">âŒ Test Failed: ${error.message}</div>`;
            }
        }
        
        // Test on page load
        console.log('ğŸš€ Debug page loaded. Click the button to test job matching.');
    </script>
</body>
</html>